from rich.console import Console
from rich.panel import Panel
from rich.prompt import Prompt
from openai import OpenAI
from api_key_manager import get_api_key
from api_key_manager import get_api_key
from video_module import generate_video

console = Console()

def main():
    console.print(Panel("[bold green]AizahraAI Chat & Video[/bold green]"))
    chat_history = []
    client = None

    while True:
        user_input = Prompt.ask("[bold cyan]Anda[/bold cyan]").strip()
        if user_input.lower() in ("/exit", "exit"):
            console.print("[red]Keluar dari program.[/red]")
            break
        if user_input == "":
            continue

        if user_input.startswith("/video "):
            video_prompt = user_input[len("/video "):].strip()
            try:
                generate_video(video_prompt)
            except Exception as e:
                console.print(f"[red]Error generate video:[/red] {e}")
            continue

        chat_history.append({"role": "user", "content": user_input})

        try:
            api_key = get_api_key("openai")
            if client is None:
                client = OpenAI(api_key=api_key)
            else:
                client.api_key = api_key

            response = client.chat.completions.create(
                model="gpt-4o-mini",
                messages=chat_history,
            )
            assistant_reply = response.choices[0].message.content
            chat_history.append({"role": "assistant", "content": assistant_reply})
            console.print(f"[green]AizahraAI:[/green] {assistant_reply}")
        except Exception as e:
            console.print(f"[red]Error:[/red] {e}")

if __name__ == "__main__":
    main()

